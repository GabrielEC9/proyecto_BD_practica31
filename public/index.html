<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión Taller Automotriz</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #f0f2f5; padding: 20px; font-family: Arial, sans-serif; }
  h1 { text-align: center; margin-bottom: 30px; color: #333; }
  .card { margin-bottom: 20px; }
  .vehiculos { margin-top: 10px; }
  .orden { border-left: 5px solid #4CAF50; padding: 10px; margin-bottom: 10px; background: #fff; border-radius: 5px; }
  .prioritaria { border-left-color: #FF4136; }
  .no-prioritaria { border-left-color: #007BFF; }
  .tablero { display: flex; gap: 20px; flex-wrap: wrap; }
  .columna { flex: 1; min-width: 250px; }
</style>
</head>
<body>

<h1>Taller Automotriz Interactivo</h1>

<div class="container">
  <h2>Clientes y Vehículos</h2>
  <div id="clientes-section" class="row"></div>

  <h2>Órdenes de Trabajo</h2>
  <div class="tablero" id="ordenes-section">
    <div class="columna">
      <h5>Pendientes</h5>
      <div id="pendientes"></div>
    </div>
    <div class="columna">
      <h5>En Progreso</h5>
      <div id="en-progreso"></div>
    </div>
    <div class="columna">
      <h5>Completadas</h5>
      <div id="completadas"></div>
    </div>
  </div>
</div>

<script>
async function cargarClientes() {
  const res = await fetch('/api/clientes')
  const clientes = await res.json()
  const contenedor = document.getElementById('clientes-section')
  clientes.forEach(c => {
    const card = document.createElement('div')
    card.className = 'col-md-4'
    card.innerHTML = `
      <div class="card p-3">
        <h5>${c.nombre}</h5>
        <p>Tel: ${c.telefono || ''}</p>
        <p>Dir: ${c.direccion || ''}</p>
        <button class="btn btn-sm btn-primary toggle-veh">Ver Vehículos</button>
        <div class="vehiculos mt-2" style="display:none;">
          ${c.vehiculo.map(v => `<div>${v.marca} ${v.modelo} (${v.año}) - Placas: ${v.placas}</div>`).join('')}
        </div>
      </div>`
    const btn = card.querySelector('.toggle-veh')
    const vehDiv = card.querySelector('.vehiculos')
    btn.addEventListener('click', () => {
      vehDiv.style.display = vehDiv.style.display === 'none' ? 'block' : 'none'
    })
    contenedor.appendChild(card)
  })
}

async function cargarOrdenes() {
  const res = await fetch('/api/ordenes')
  const ordenes = await res.json()
  ordenes.forEach(o => {
    const div = document.createElement('div')
    div.className = `orden ${o.orden_prioritaria ? 'prioritaria' : 'no-prioritaria'}`
    div.innerHTML = `
      <strong>ID: ${o.id_orden}</strong> <br>
      Vehículo: ${o.vehiculo?.marca || ''} ${o.vehiculo?.modelo || ''} <br>
      Cliente: ${o.vehiculo?.cliente?.nombre || ''} <br>
      Servicio: ${o.servicio?.descripcion || ''} ($${o.servicio?.costo || ''}) <br>
      Estado: ${o.estado_pago || ''}`
    
    if(o.estado_pago === 'Pendiente') document.getElementById('pendientes').appendChild(div)
    else if(o.estado_pago === 'En progreso') document.getElementById('en-progreso').appendChild(div)
    else document.getElementById('completadas').appendChild(div)
  })
}

cargarClientes()
cargarOrdenes()
</script>

</body>
</html>

